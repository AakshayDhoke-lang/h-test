<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | HostelComplaint</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <i class="fas fa-building"></i>
                    <span>HostelComplaint</span>
                </div>
                
                <div class="nav-links">
                    <a href="student-dashboard.html" class="nav-link active">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                    <a href="complaints.html?role=student" class="nav-link">
                        <i class="fas fa-list"></i> My Complaints
                    </a>
                    <a href="new-complaint.html" class="nav-link">
                        <i class="fas fa-plus-circle"></i> New Complaint
                    </a>
                    <a href="messages.html" class="nav-link">
                        <i class="fas fa-comments"></i> Messages
                        <span class="notification-badge hidden" id="message-notification">0</span>
                    </a>
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="current-user-name">Loading...</span>
                    </div>
                    <button id="logout-btn" class="btn btn-secondary">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </nav>
        </div>
    </header>
    
    <main>
        <div class="container">
            <div class="page-header">
                <h1>Student Dashboard</h1>
                <p>Welcome back! Here's an overview of your complaints.</p>
            </div>
            
            <div class="dashboard-cards">
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="card-title">Total Complaints</div>
                    <div class="card-value" id="total-complaints">0</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="card-title">Pending</div>
                    <div class="card-value" id="pending-complaints">0</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-tools"></i>
                    </div>
                    <div class="card-title">In Progress</div>
                    <div class="card-value" id="inprogress-complaints">0</div>
                </div>
                
                <div class="card">
                    <div class="card-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="card-title">Resolved</div>
                    <div class="card-value" id="resolved-complaints">0</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h2>Recent Complaints</h2>
                    <a href="complaints.html?role=student" class="btn btn-secondary">View All</a>
                </div>
                
                <div class="table-container">
                    <table id="recent-complaints-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="recent-complaints-body">
                            <!-- Will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h2>Quick Actions</h2>
                </div>
                
                <div class="quick-actions">
                    <a href="new-complaint.html" class="action-card">
                        <i class="fas fa-plus-circle"></i>
                        <h3>Submit New Complaint</h3>
                        <p>Report a new issue or maintenance request</p>
                    </a>
                    
                    <a href="messages.html" class="action-card">
                        <i class="fas fa-comments"></i>
                        <h3>View Messages</h3>
                        <p>Check messages from warden and staff</p>
                    </a>
                    
                    <a href="complaints.html?role=student&status=Resolved" class="action-card">
                        <i class="fas fa-star"></i>
                        <h3>Provide Feedback</h3>
                        <p>Rate resolved complaints</p>
                    </a>
                </div>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>HostelComplaint</h3>
                    <p>Streamlining hostel maintenance and complaint resolution for better student living.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Need Help?</h3>
                    <p>Contact Warden: 9:00 AM - 5:00 PM</p>
                    <p>Emergency: 24/7 Maintenance</p>
                </div>
            </div>
            
            <div class="text-center mt-2">
                <p>&copy; 2023 HostelComplaint System. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/database.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/student.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check authentication
            const currentUser = getCurrentUser();
            if (!currentUser || currentUser.role !== 'student') {
                window.location.href = 'index.html';
                return;
            }
            
            // Set user name
            document.getElementById('current-user-name').textContent = currentUser.name;
            
            // Load dashboard data
            loadStudentDashboard();
            
            // Check for new messages
            updateMessageNotification();
            
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                sessionStorage.removeItem('currentUser');
                window.location.href = 'index.html';
            });
            
            // Update notification badge every 30 seconds
            setInterval(updateMessageNotification, 30000);
        });
        
        function loadStudentDashboard() {
            const currentUser = getCurrentUser();
            const complaints = getComplaints().filter(c => c.studentId === currentUser.id);
            
            // Update counts
            document.getElementById('total-complaints').textContent = complaints.length;
            document.getElementById('pending-complaints').textContent = complaints.filter(c => c.status === 'Submitted').length;
            document.getElementById('inprogress-complaints').textContent = complaints.filter(c => ['Assigned', 'In Progress'].includes(c.status)).length;
            document.getElementById('resolved-complaints').textContent = complaints.filter(c => ['Resolved', 'Closed'].includes(c.status)).length;
            
            // Load recent complaints
            const recentComplaints = complaints
                .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
                .slice(0, 5);
            
            const tbody = document.getElementById('recent-complaints-body');
            tbody.innerHTML = '';
            
            recentComplaints.forEach(complaint => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${complaint.id}</td>
                    <td>${complaint.category}</td>
                    <td>${complaint.description.substring(0, 40)}${complaint.description.length > 40 ? '...' : ''}</td>
                    <td><span class="priority-badge priority-${complaint.priority.toLowerCase()}">${complaint.priority}</span></td>
                    <td><span class="status-badge status-${complaint.status.toLowerCase().replace(' ', '-')}">${complaint.status}</span></td>
                    <td>${new Date(complaint.createdAt).toLocaleDateString()}</td>
                    <td>
                        <a href="complaint-details.html?id=${complaint.id}" class="btn btn-small">View</a>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function updateMessageNotification() {
            const currentUser = getCurrentUser();
            const messages = getMessages();
            const unreadCount = messages.filter(m => 
                m.receiverId === currentUser.id && 
                m.status === 'unread'
            ).length;
            
            const badge = document.getElementById('message-notification');
            if (unreadCount > 0) {
                badge.textContent = unreadCount;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }
        }
    </script>
</body>
</html> 